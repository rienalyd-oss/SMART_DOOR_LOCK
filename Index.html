<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SMART DOOR LOCK SYSTEM</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        body {
            font-family: 'Poppins',sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* LOGO */
        #logo-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #b20a2c;
            color: white;
            cursor: pointer;
            animation: fadeIn 1s ease-in-out;
        }

        .logo-img {
            width: 120px;
            animation: float 3s ease-in-out infinite;
        }

        /* MAIN */
        #main-content {
            flex: 1;
            display: none;
            flex-direction: column;
            background: linear-gradient(-45deg,#ffffff,#f8d7da,#ffffff,#ffe6ea);
            background-size: 400% 400%;
            animation: gradientBG 10s ease infinite;
        }

        header {
            background: #b20a2c;
            color: white;
            text-align: center;
            padding: 10px;
        }

        footer {
            background: #b20a2c;
            color: white;
            text-align: center;
            font-size: 13px;
            margin-top: auto;
            padding: 10px;
        }

        /* MODE */
        .mode-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 60px auto;
            animation: slideUp 0.8s ease-in-out;
        }

            .mode-selection button {
                width: 250px;
                height: 60px;
                font-size: 18px;
                border: none;
                border-radius: 12px;
                background: linear-gradient(to right,#b31217,#e52d27);
                color: white;
                font-weight: 600;
                cursor: pointer;
                transition: 0.3s;
                box-shadow: 0 6px 15px rgba(0,0,0,.2);
            }

                .mode-selection button:hover {
                    transform: scale(1.05);
                    background: linear-gradient(to right,#190A05,#870000);
                }

        /* FORM */
        .form-container {
            max-width: 800px;
            margin: 25px auto;
            padding: 25px;
            border-radius: 20px;
            background: rgba(255,255,255,.6);
            backdrop-filter: blur(15px);
            box-shadow: 0 15px 40px rgba(0,0,0,.25);
            animation: fadeSlide 0.8s ease-in-out;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        /* TERMS */
        .terms-row {
            display: flex;
            align-items: center;
            font-size: 14px;
            margin: 15px 0;
        }

            .terms-row input {
                width: auto;
                margin-right: 8px;
            }

        .terms-link {
            color: red;
            cursor: pointer;
        }

            .terms-link:hover {
                text-decoration: underline;
            }

        /* BUTTONS */
        button.submit {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            background: linear-gradient(to right,#b31217,#e52d27);
            box-shadow: 0 6px 15px rgba(0,0,0,.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

            button.submit:hover {
                background: linear-gradient(to right,#190A05,#870000);
                transform: scale(1.05);
                box-shadow: 0 10px 25px rgba(0,0,0,.3);
            }

            button.submit:active {
                transform: scale(0.95);
            }

            button.submit:disabled {
                background: gray !important;
                cursor: not-allowed;
                transform: none !important;
                box-shadow: none;
            }

        button.cancel {
            background: #6c757d;
            margin-top: 10px;
        }

            button.cancel:hover {
                background: linear-gradient(to right,#b31217,#e52d27);
            }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.6);
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .modal-content {
            background: white;
            padding: 30px;
            width: 80%;
            max-width: 600px;
            border-radius: 15px;
            position: relative;
            animation: fadeIn 0.4s ease-in-out;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-weight: bold;
            cursor: pointer;
            color: red;
        }

        /* BADGES */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            color: white;
            margin-left: 10px;
        }

        .staff {
            background: #007bff;
        }

        .guest {
            background: #28a745;
        }

        /* ANIMATIONS */
        @keyframes float {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes fadeSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* TOAST NOTIFICATION */
        #toast {
            position: fixed;
            top: 20px;
            right: -400px;
            background: linear-gradient(to right,#b31217,#e52d27);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,.3);
            font-weight: 500;
            transition: right 0.5s ease;
            z-index: 1000;
        }

            #toast.show {
                right: 20px;
            }

        /* OTP OVERLAY */
        .otp-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease;
            z-index: 2000;
        }

            .otp-overlay.show {
                opacity: 1;
                visibility: visible;
            }

        .otp-box {
            background: white;
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            animation: fadeIn 0.4s ease;
        }
    </style>
</head>
<body>

    <!-- LOGO -->
    <div id="logo-screen" onclick="showModes()">
        <img src="IMAGE/logo.png" class="logo-img">
        <h1>Smart Door Lock System</h1>
        <p>Click to proceed</p>
    </div>

    <!-- MAIN -->
    <div id="main-content">
        <header><h1>Smart Door Lock System</h1></header>

        <div class="mode-selection" id="mode-selection">
            <button onclick="showSection('staff')">STAFF</button>
            <button onclick="showSection('guest')">GUEST</button>
            <button onclick="showSection('admin')">ADMIN</button>
        </div>

        <!-- STAFF -->
        <div id="staff-section" style="display:none;">
            <div class="form-container">
                <h2>Staff Registration</h2>
                <input type="text" id="staffName" placeholder="Name">
                <input type="text" id="staffCode" placeholder="Code">
                <input type="file" id="staffFace" accept="image/*">
                <div class="terms-row">
                    <input type="checkbox" id="staffCheck" onchange="toggleButton('staff')">
                    <span>I agree to <span class="terms-link" onclick="openTerms()"><b>TERMS AND CONDITIONS</b></span></span>
                </div>
                <button class="submit" id="staffBtn" disabled onclick="registerStaff()">Register</button>
                <button class="submit cancel" id="cancelStaffBtn" style="display:none;" onclick="cancelEditStaff()">Cancel</button>
            </div>
        </div>

        <!-- GUEST -->
        <div id="guest-section" style="display:none;">
            <div class="form-container">
                <h2>Guest Registration</h2>
                <input type="text" id="guestName" placeholder="Name">
                <input type="email" id="guestEmail" placeholder="Email">
<textarea id="guestReason" placeholder="Reason for Entry"></textarea>
                <input type="file" id="guestFace" accept="image/*">
                <div class="terms-row">
                    <input type="checkbox" id="guestCheck" onchange="toggleButton('guest')">
                    <span>I agree to <span class="terms-link" onclick="openTerms()"><b>TERMS AND CONDITIONS</b></span></span>
                </div>
                <button class="submit" id="guestBtn" disabled onclick="registerGuest()">Submit</button>
            </div>
        </div>

        <!-- ADMIN -->
        <div id="admin-section" style="display:none;">
            <div class="form-container">
                <h2>Admin Registration</h2>
                <input type="text" id="adminName" placeholder="Admin Name">
                <input type="text" id="adminSelfCode" placeholder="Self Code">
                <input type="text" id="adminNormalCode" placeholder="Normal Mode Code">
                <input type="text" id="adminGuestCode" placeholder="Guest Mode Code">
                <input type="text" id="adminRestrictedCode" placeholder="Restricted Mode Code">
                <input type="text" id="adminStandardCode" placeholder="Standard Mode Code">
                <input type="file" id="adminFace" accept="image/*">
                <div class="terms-row">
                    <input type="checkbox" id="adminCheck" onchange="toggleButton('admin')">
                    <span>I agree to <span class="terms-link" onclick="openTerms()"><b>TERMS AND CONDITIONS</b></span></span>
                </div>
                <button class="submit" id="adminBtn" disabled onclick="registerAdmin()">Register</button>
            </div>
        </div>
        <div id="admin-panel" style="display:none;">
            <div class="form-container" style="text-align:center;">
                <img src="IMAGE/logo.png" class="logo-img">

                <h2>Admin Panel</h2>

                <button class="submit" style="margin-bottom:20px;" onclick="showLogs()">LOG HISTORY</button>

                <button class="submit" id="adminEditBtn" onclick="editAdmin()">EDIT PROFILE</button>
            </div>
        </div>

        <footer>&copy; 2026 Smart Door Lock System</footer>
    </div>

    <!-- MODAL -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeTerms()">X</span>
            <h2>Terms and Conditions</h2>
            <p>By registering, you agree to follow all security rules and policies.</p>
            <p>Unauthorized access or misuse is strictly prohibited.</p>
            <p>All data collected is for security purposes only.</p>
        </div>
    </div>

    <script>
        let originalAdminData = {};
        let isAdminEditing = false;
        let logs = [];
        function showModes() { document.getElementById("logo-screen").style.display = "none"; document.getElementById("main-content").style.display = "flex"; }
        function showSection(type) { document.getElementById("mode-selection").style.display = "none"; document.getElementById(type + "-section").style.display = "block"; }
        function toggleButton(type) { let check = document.getElementById(type + "Check"); let btn = document.getElementById(type + "Btn"); btn.disabled = !check.checked; if (type == "staff") { document.getElementById("saveStaffBtn").disabled = true; } }
        function openTerms() { document.getElementById("termsModal").style.display = "flex"; }
        function closeTerms() { document.getElementById("termsModal").style.display = "none"; }

        // STAFF
        let originalStaffData = {};
        let isEditing = false;

        function showToast(message) {
            let toast = document.getElementById("toast");
            toast.innerText = message;
            toast.classList.add("show");

            setTimeout(() => {
                toast.classList.remove("show");
            }, 3000);
        }

        function registerStaff() {
            let name = document.getElementById("staffName").value;
            let code = document.getElementById("staffCode").value;
            let face = document.getElementById("staffFace").value;

            if (!name || !code || !face) {
                showToast("All fields are required before registering ❗");
                return;
            }

            // Save original values
            originalStaffData = {
                name: name,
                code: code
            };

            // Lock inputs
            setStaffReadonly(true);

            // Change button to Edit Profile
            let btn = document.getElementById("staffBtn");
            btn.innerText = "Edit Profile";
            btn.onclick = startEdit;
            btn.disabled = false;

            showToast("Staff registered successfully ✅");
        }

        function startEdit() {
            isEditing = true;

            setStaffReadonly(false);

            let btn = document.getElementById("staffBtn");
            btn.innerText = "Save Profile";
            btn.disabled = true; // disabled muna
            btn.onclick = saveStaff;

            document.getElementById("cancelStaffBtn").style.display = "block";

            // Detect changes
            document.getElementById("staffName").addEventListener("input", detectChanges);
            document.getElementById("staffCode").addEventListener("input", detectChanges);
        }

        function detectChanges() {
            let currentName = document.getElementById("staffName").value;
            let currentCode = document.getElementById("staffCode").value;

            let btn = document.getElementById("staffBtn");

            if (
                currentName !== originalStaffData.name ||
                currentCode !== originalStaffData.code
            ) {
                btn.disabled = false;
            } else {
                btn.disabled = true;
            }
        }

        function saveStaff() {
            originalStaffData = {
                name: document.getElementById("staffName").value,
                code: document.getElementById("staffCode").value
            };

            setStaffReadonly(true);

            let btn = document.getElementById("staffBtn");
            btn.innerText = "Edit Profile";
            btn.onclick = startEdit;
            btn.disabled = false;

            document.getElementById("cancelStaffBtn").style.display = "none";
            isEditing = false;

            showToast("Profile updated successfully ✨");
        }

        function cancelEditStaff() {
            // revert values
            document.getElementById("staffName").value = originalStaffData.name;
            document.getElementById("staffCode").value = originalStaffData.code;

            setStaffReadonly(true);

            let btn = document.getElementById("staffBtn");
            btn.innerText = "Edit Profile";
            btn.onclick = startEdit;
            btn.disabled = false;

            document.getElementById("cancelStaffBtn").style.display = "none";
            isEditing = false;
        }

        function setStaffReadonly(state) {
            if (state) {
                document.getElementById("staffName").setAttribute("readonly", true);
                document.getElementById("staffCode").setAttribute("readonly", true);
                document.getElementById("staffFace").setAttribute("disabled", true);
            } else {
                document.getElementById("staffName").removeAttribute("readonly");
                document.getElementById("staffCode").removeAttribute("readonly");
                document.getElementById("staffFace").removeAttribute("disabled");
            }
        }

        function showToast(message) {
            let toast = document.getElementById("toast");
            toast.innerText = message;
            toast.classList.add("show");

            setTimeout(() => {
                toast.classList.remove("show");
            }, 3000);
        }

        // GUEST
        function registerGuest() {
            let n = document.getElementById("guestName").value;
            let e = document.getElementById("guestEmail").value;
            let r = document.getElementById("guestReason").value;
            let f = document.getElementById("guestFace").value;

            if (!n || !e || !r || !f) {
                showToast("All fields are required before registering ❗");
                return;
            }

            let otp = document.getElementById("otpMessage");

            // Show OTP message
            otp.classList.add("show");

            setTimeout(() => {
                otp.classList.remove("show");

                // Reset guest form
                document.getElementById("guestName").value = "";
                document.getElementById("guestEmail").value = "";
                document.getElementById("guestReason").value = "";
                document.getElementById("guestFace").value = "";
                document.getElementById("guestCheck").checked = false;
                document.getElementById("guestBtn").disabled = true;

                // Go back to mode selection
                document.getElementById("guest-section").style.display = "none";
                document.getElementById("mode-selection").style.display = "flex";

            }, 3000);
        }

        // ADMIN
        function registerAdmin() {
            let name = document.getElementById("adminName").value;
            let selfCode = document.getElementById("adminSelfCode").value;
            let normalCode = document.getElementById("adminNormalCode").value;
            let guestCode = document.getElementById("adminGuestCode").value;

            if (!name || !selfCode || !normalCode || !guestCode) {
                showToast("Please complete the form first ❗");
                return;
            }

            // Save original admin data
            originalAdminData = {
                name: document.getElementById("adminName").value,
                selfCode: document.getElementById("adminSelfCode").value,
                normalCode: document.getElementById("adminNormalCode").value,
                guestCode: document.getElementById("adminGuestCode").value,
                restrictedCode: document.getElementById("adminRestrictedCode").value,
                standardCode: document.getElementById("adminStandardCode").value
            };

            // Make inputs readonly
            document.querySelectorAll("#admin-section input").forEach(i => {
                i.setAttribute("readonly", true);
            });

            // Hide form
            document.querySelector("#admin-section .form-container").style.display = "none";

            // Show admin panel
            document.getElementById("admin-panel").style.display = "block";

            showToast("Admin registered successfully ✅");
        }
        function editAdmin() {

            isAdminEditing = true;

            // Hide admin panel
            document.getElementById("admin-panel").style.display = "none";

            // Show form
            document.querySelector("#admin-section .form-container").style.display = "block";

            // Make inputs editable
            document.querySelectorAll("#admin-section input").forEach(input => {
                input.removeAttribute("readonly");
                input.addEventListener("input", detectAdminChanges);
            });

            // Change button to SAVE PROFILE
            let btn = document.getElementById("adminBtn");
            btn.innerText = "SAVE PROFILE";
            btn.onclick = saveAdmin;
            btn.disabled = true; // disabled muna

            // Show cancel button
            addAdminCancelButton();
        }

        function showLogs() {
            if (logs.length === 0) {
                showToast("No log history available 📜");
                return;
            }

            let content = "<h2>Log History</h2>";

            logs.forEach(l => {
                content += `
        <p>
            <b>${l.name}</b>
            <span class="badge ${l.type.toLowerCase()}">${l.type}</span>
            <br>
            <small>${l.time}</small>
        </p>
        <hr>
        `;
            });

            document.body.innerHTML += `
    <div class="modal" style="display:flex;">
        <div class="modal-content">
            <span class="close-btn" onclick="this.parentElement.parentElement.remove()">X</span>
            ${content}
        </div>
    </div>
    `;
        }

        function detectAdminChanges() {

            if (!isAdminEditing) return;

            let btn = document.getElementById("adminBtn");

            let hasChanges =
                document.getElementById("adminName").value !== originalAdminData.name ||
                document.getElementById("adminSelfCode").value !== originalAdminData.selfCode ||
                document.getElementById("adminNormalCode").value !== originalAdminData.normalCode ||
                document.getElementById("adminGuestCode").value !== originalAdminData.guestCode ||
                document.getElementById("adminRestrictedCode").value !== originalAdminData.restrictedCode ||
                document.getElementById("adminStandardCode").value !== originalAdminData.standardCode;

            btn.disabled = !hasChanges;
        }

        function saveAdmin() {

            originalAdminData = {
                name: document.getElementById("adminName").value,
                selfCode: document.getElementById("adminSelfCode").value,
                normalCode: document.getElementById("adminNormalCode").value,
                guestCode: document.getElementById("adminGuestCode").value,
                restrictedCode: document.getElementById("adminRestrictedCode").value,
                standardCode: document.getElementById("adminStandardCode").value
            };

            document.querySelectorAll("#admin-section input").forEach(i => {
                i.setAttribute("readonly", true);
            });

            document.getElementById("adminCancelBtn").remove();

            let btn = document.getElementById("adminBtn");
            btn.innerText = "Register";
            btn.onclick = registerAdmin;
            btn.disabled = false;

            isAdminEditing = false;

            document.querySelector("#admin-section .form-container").style.display = "none";
            document.getElementById("admin-panel").style.display = "block";

            showToast("Admin profile updated successfully ✨");
        }
        function cancelAdminEdit() {

            document.getElementById("adminName").value = originalAdminData.name;
            document.getElementById("adminSelfCode").value = originalAdminData.selfCode;
            document.getElementById("adminNormalCode").value = originalAdminData.normalCode;
            document.getElementById("adminGuestCode").value = originalAdminData.guestCode;
            document.getElementById("adminRestrictedCode").value = originalAdminData.restrictedCode;
            document.getElementById("adminStandardCode").value = originalAdminData.standardCode;

            document.querySelectorAll("#admin-section input").forEach(i => {
                i.setAttribute("readonly", true);
            });

            document.getElementById("adminCancelBtn").remove();

            let btn = document.getElementById("adminBtn");
            btn.innerText = "Register";
            btn.onclick = registerAdmin;
            btn.disabled = false;

            isAdminEditing = false;

            document.querySelector("#admin-section .form-container").style.display = "none";
            document.getElementById("admin-panel").style.display = "block";
        }

        function addAdminCancelButton() {

            if (!document.getElementById("adminCancelBtn")) {

                let cancelBtn = document.createElement("button");
                cancelBtn.innerText = "CANCEL";
                cancelBtn.className = "submit cancel";
                cancelBtn.id = "adminCancelBtn";
                cancelBtn.onclick = cancelAdminEdit;

                document.querySelector("#admin-section .form-container")
                    .appendChild(cancelBtn);
            }
        }
    </script>
    <div id="otpMessage" class="otp-overlay">
        <div class="otp-box">
            YOUR OTP WILL BE SENT TO YOUR EMAIL 📩
        </div>
    </div>

    <div id="toast"></div>
</body>
</html>